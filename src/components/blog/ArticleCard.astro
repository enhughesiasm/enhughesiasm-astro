---
import CoolCard from '../shared/CoolCard.astro';
import type { Post } from './api/post';
import { getCategories } from './api/fetch_categories';
import { getMediaById } from './api/fetch_media';
import {
	DEFAULT_WP_MEDIA_ID,
	FEATURED_WP_IMAGE_HEIGHT,
	FEATURED_WP_IMAGE_WIDTH,
} from '../../data/definitions';
import { Image } from 'astro:assets';

import defaultImage from '../../assets/images/other/default_image.jpg';

export type Props = {
	post: Post;
};

const categories = await getCategories();

const { post } = Astro.props;

const featured_media = await getMediaById(
	post.featured_media === 0 ? DEFAULT_WP_MEDIA_ID : post.featured_media
);

const imageUrl =
	featured_media?.source_url ??
	"/default_image.jpg";
const altText = featured_media?.alt_text ?? '';
const imageType = featured_media?.mime_type ?? '';
---

<CoolCard
	title={post.title.rendered}
	subtitle={post.excerpt.rendered}
	slug={`${import.meta.env.BASE_URL}articles/${post.slug}`}
	tags={post.categories.map(
		(c) => categories.find((cat) => cat.id === c)?.name ?? ''
	)}
>
	<Image
		src={imageUrl}
		alt={altText}
		slot='image'
		width={FEATURED_WP_IMAGE_WIDTH}
		height={FEATURED_WP_IMAGE_HEIGHT}
	/>
</CoolCard>
