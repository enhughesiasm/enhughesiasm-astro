---
import { LeftRoundArrow, RightRoundArrow } from 'iconoir-react';
import ArticleCard from '../../../components/blog/ArticleCard.astro';
import {
	getArticles,
	getTotalPageNumber,
} from '../../../components/blog/fetch_posts';
import type { Post } from '../../../components/blog/post';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import LayoutPage from '../../../layouts/Layout_Page.astro';

export async function getStaticPaths({ paginate }: { paginate: Function }) {
	const POSTS_PER_PAGE = 20;
	const pageCount = await getTotalPageNumber(POSTS_PER_PAGE);
	let allPosts: Post[] = [];
	for (let i = 1; i <= pageCount; i++) {
		allPosts = allPosts.concat(await getArticles(i, POSTS_PER_PAGE));
	}

	return paginate(allPosts, { pageSize: POSTS_PER_PAGE });
}

const { page } = Astro.props;
---

<BaseLayout
	title={`Articles by Neil Hughes - page ${page.currentPage} - enhughesiasm`}
>
	<LayoutPage>
		<div class='flex flex-row items-center justify-center space-x-3'>
			<h2
				class='rounded-xl bg-amber-200 py-3 px-6 font-serif text-3xl font-bold text-zinc-700'
			>
				Articles by Neil Hughes
			</h2>
		</div>
		<div
			class='flex flex-row items-center justify-center space-x-1 py-3 text-xl'
		>
			{
				page.url.prev && (
					<a
						class='text-blue-500 hover:text-blue-400'
						href={page.url.prev}>
						<LeftRoundArrow />
					</a>
				)
			}
			<span>{page.currentPage} / {page.lastPage}</span>
			{
				page.url.next && (
					<a
						class='text-blue-500 hover:text-blue-400'
						href={page.url.next}>
						<RightRoundArrow />
					</a>
				)
			}
		</div>

		<div class='mt-12 grid grid-cols-4 gap-y-6'>
			{page.data.map((post: Post) => <ArticleCard post={post} />)}
		</div>

		<div class='mt-6 flex w-full justify-evenly py-6 text-4xl'>
			<div class='flex flex-row items-center space-x-3'>
				{
					page.url.prev && (
						<a
							class='text-blue-500 hover:text-blue-400'
							href={page.url.prev}>
							<LeftRoundArrow />
						</a>
					)
				}
				<span>{page.currentPage} / {page.lastPage}</span>
				{
					page.url.next && (
						<a
							class='text-blue-500 hover:text-blue-400'
							href={page.url.next}>
							<RightRoundArrow />
						</a>
					)
				}
			</div>
		</div>
	</LayoutPage>
</BaseLayout>
